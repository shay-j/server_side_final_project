<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cost Manager • Admin Dashboard</title>
  <style>
    :root{
      --bg: #0b1020;           /* background */
      --panel: rgba(255,255,255,0.08);
      --panel-strong: rgba(255,255,255,0.12);
      --border: rgba(255,255,255,0.15);
      --text: #e6eaf2;
      --muted: #a8b0c3;
      --primary: #5eead4;      /* teal */
      --primary-600: #2dd4bf;
      --accent: #8b5cf6;       /* violet */
      --danger: #f87171;       /* red */
      --ok: #86efac;          /* green */
      --warn: #fbbf24;        /* amber */
      --code-bg: #0f172a;     /* slate-900 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font: 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:
              radial-gradient(1200px 600px at 15% -10%, #1c2544 0%, transparent 60%),
              radial-gradient(800px 500px at 90% 10%, #241c44 0%, transparent 55%),
              radial-gradient(900px 600px at 60% 100%, #143a38 0%, transparent 60%),
              var(--bg);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:28px}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(120%) blur(10px);
      background: linear-gradient(180deg, rgba(10,15,30,.85), rgba(10,15,30,.35));
      border-bottom:1px solid var(--border);
    }
    .bar{display:flex; gap:16px; align-items:center; padding:14px 28px}
    .brand{display:flex; gap:10px; align-items:center; font-weight:700; letter-spacing:.3px}
    .brand .logo{width:28px; height:28px; display:grid; place-items:center; border-radius:10px; background: linear-gradient(135deg, var(--primary), var(--accent)); box-shadow:0 6px 24px rgba(94,234,212,.35)}
    .brand .logo svg{filter: drop-shadow(0 2px 8px rgba(0,0,0,.4));}
    .sp{flex:1}
    .base-url{display:flex; gap:10px; align-items:center}
    .base-url input{width:360px}

    .grid{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); margin-top:20px}
    .card{
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.04));
      border:1px solid var(--border); border-radius:16px; padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .card h3{margin:0 0 10px 0; font-size:18px}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, select, button, .btn{
      -webkit-appearance:none; appearance:none; outline:none;
      background: rgba(255,255,255,0.08);
      color: var(--text); border:1px solid var(--border); border-radius:10px;
      padding:10px 12px; font-size:14px; width:100%;
      transition: .2s ease; backdrop-filter: blur(6px);
    }
    input:focus, select:focus{border-color:var(--primary); box-shadow: 0 0 0 3px rgba(94,234,212,.15)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px}

    .actions{display:flex; gap:10px; margin-top:12px}
    .btn, button{cursor:pointer}
    .btn.primary{background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; font-weight:600; box-shadow:0 10px 24px rgba(139,92,246,.35)}
    .btn.ghost{background: transparent}
    .btn.outline{background:transparent; border:1px solid var(--primary); color:var(--primary)}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .panels{display:grid; gap:16px; grid-template-columns:1.2fr .8fr}
    @media (max-width: 980px){ .panels{grid-template-columns:1fr} }

    .pre{background: var(--code-bg); border:1px solid var(--border); border-radius:12px; padding:12px; font: 13px/1.5 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; white-space:pre-wrap; word-break:break-word; max-height:400px; overflow:auto}

    .tabs{display:flex; gap:6px; margin-bottom:10px}
    .tab{padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,.05); cursor:pointer; font-size:13px}
    .tab.active{border-color:var(--primary); box-shadow:0 0 0 3px rgba(94,234,212,.15)}

    .badge{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:rgba(255,255,255,.05)}
    .status.ok{color:var(--ok)}
    .status.err{color:var(--danger)}

    .toast{position:fixed; right:18px; bottom:18px; background:rgba(16,24,48,.95); border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:10px; box-shadow:0 12px 30px rgba(0,0,0,.35); opacity:0; transform: translateY(10px); transition:.2s}
    .toast.show{opacity:1; transform:none}

    .hint{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
<header>
  <div class="bar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 12a7 7 0 1014 0A7 7 0 005 12zm7-9v4m0 10v4M3 12h4m10 0h4M7.5 7.5l2.5 2.5m4 4l2.5 2.5m0-9L14 10m-4 4l-3 3" stroke="#081621" stroke-width="1.2"/>
        </svg>
      </div>
      Cost Manager • Admin
    </div>
    <div class="sp"></div>
    <div class="base-url">
      <span class="badge">Base URL</span>
      <input id="baseUrl" placeholder="https://your-deploy.example.com" />
      <button class="btn outline" id="saveBase">Save</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <div class="card">
      <h3>Add User</h3>
      <div class="row">
        <div>
          <label>User ID</label>
          <input id="u_id" type="number" placeholder="123123" />
        </div>
        <div>
          <label>Birthday</label>
          <input id="u_bday" type="date" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>First name</label>
          <input id="u_first" placeholder="Mosh" />
        </div>
        <div>
          <label>Last name</label>
          <input id="u_last" placeholder="Israeli" />
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnAddUser">Create user</button>
        <button class="btn ghost" id="btnUserSample">Fill sample</button>
      </div>
    </div>

    <div class="card">
      <h3>Add Cost</h3>
      <div>
        <label>Description</label>
        <input id="c_desc" placeholder="Groceries" />
      </div>
      <div class="row3">
        <div>
          <label>Category</label>
          <select id="c_cat">
            <option value="food">food</option>
            <option value="health">health</option>
            <option value="housing">housing</option>
            <option value="sports">sports</option>
            <option value="education">education</option>
          </select>
        </div>
        <div>
          <label>User ID</label>
          <input id="c_uid" type="number" placeholder="123123" />
        </div>
        <div>
          <label>Sum</label>
          <input id="c_sum" type="number" step="0.01" placeholder="87.90" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Created at (optional)</label>
          <input id="c_date" type="date" />
          <div class="hint">Leave empty to use the server time. Past months are blocked.</div>
        </div>
        <div></div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnAddCost">Create cost</button>
        <button class="btn ghost" id="btnCostSample">Fill sample</button>
      </div>
    </div>

    <div class="card">
      <h3>Monthly Report</h3>
      <div class="row3">
        <div>
          <label>User ID</label>
          <input id="r_uid" type="number" placeholder="123123" />
        </div>
        <div>
          <label>Month</label>
          <input id="r_month" type="month" />
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn primary" id="btnReport">Get report</button>
        </div>
      </div>
      <div class="hint">Reports for past months are cached. Current month is computed live.</div>
    </div>

    <div class="card">
      <h3>Lookup</h3>
      <div class="row">
        <div>
          <label>Get user by ID</label>
          <div class="actions">
            <input id="lu_uid" type="number" placeholder="123123" />
            <button class="btn" id="btnGetUser">Fetch</button>
          </div>
        </div>
        <div>
          <label>Utilities</label>
          <div class="actions">
            <button class="btn" id="btnListUsers">List users</button>
            <button class="btn" id="btnLogs">Show logs</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="panels" style="margin-top:20px">
    <div class="card">
      <div class="tabs">
        <div class="tab active" data-tab="req">Request JSON</div>
        <div class="tab" data-tab="res">Response</div>
      </div>
      <pre id="req" class="pre">—</pre>
      <pre id="res" class="pre" style="display:none">—</pre>
      <div class="actions">
        <button class="btn outline" id="copyBtn">Copy visible</button>
        <button class="btn ghost" id="clearBtn">Clear</button>
      </div>
    </div>
    <div class="card">
      <h3 style="display:flex;align-items:center;gap:8px">Client Logs <span class="badge"><span id="statusDot" class="status">●</span><span id="statusTxt">idle</span></span></h3>
      <pre id="logs" class="pre" style="height:360px"></pre>
    </div>
  </div>
</div>

<div id="toast" class="toast">Copied</div>

<script>
  // ——— helpers ———
  const $ = sel => document.querySelector(sel);
  const logs = $('#logs');
  const reqPre = $('#req');
  const resPre = $('#res');
  const statusTxt = $('#statusTxt');
  const statusDot = $('#statusDot');
  const toast = $('#toast');

  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(t => t.addEventListener('click', () => {
    tabs.forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    const name = t.dataset.tab;
    if(name==='req'){ reqPre.style.display='block'; resPre.style.display='none'; }
    else { reqPre.style.display='none'; resPre.style.display='block'; }
  }));

  function showToast(msg){
    toast.textContent = msg; toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1200);
  }
  function log(line){
    const t = new Date().toISOString();
    logs.textContent += `[${t}] ${line}\n`;
    logs.scrollTop = logs.scrollHeight;
  }
  function setBusy(b){
    statusTxt.textContent = b? 'working…' : 'idle';
    statusDot.style.color = b? 'var(--warn)' : 'var(--ok)';
  }
  function setReq(obj){ reqPre.textContent = typeof obj==='string' ? obj : JSON.stringify(obj, null, 2); }
  function setRes(obj){ resPre.textContent = typeof obj==='string' ? obj : JSON.stringify(obj, null, 2); }

  // ——— base URL persistence ———
  const baseInput = $('#baseUrl');
  const saveBase = $('#saveBase');
  baseInput.value = localStorage.getItem('cm_base') || location.origin;
  saveBase.addEventListener('click', ()=>{ localStorage.setItem('cm_base', baseInput.value.trim()); showToast('Saved'); });
  const API = () => (baseInput.value.trim().replace(/\/$/, ''));

  async function send(method, path, body){
    const url = API()+path;
    setBusy(true); setReq(body? {method, url, body} : `${method} ${url}`);
    log(`${method} ${url}`);
    try{
      const r = await fetch(url, {
        method,
        headers: body? {'Content-Type':'application/json'} : undefined,
        body: body? JSON.stringify(body) : undefined
      });
      const text = await r.text();
      let data; try{ data = JSON.parse(text) } catch{ data = text }
      setRes({ status: r.status, data });
      log(`→ ${r.status}`);
      return { status:r.status, data };
    }catch(err){
      setRes({ error: String(err) });
      log(`ERROR ${err}`); throw err;
    }finally{ setBusy(false); }
  }

  // ——— forms: users ———
  $('#btnUserSample').addEventListener('click', ()=>{
    const today = new Date();
    $('#u_id').value = 123123;
    $('#u_first').value = 'Mosh';
    $('#u_last').value = 'Israeli';
    $('#u_bday').value = '1998-05-10';
  });

  $('#btnAddUser').addEventListener('click', async ()=>{
    const body = {
      id: Number($('#u_id').value),
      first_name: $('#u_first').value.trim(),
      last_name: $('#u_last').value.trim(),
      birthday: $('#u_bday').value
    };
    await send('POST','/api/add', body);
  });

  // ——— forms: costs ———
  $('#btnCostSample').addEventListener('click', ()=>{
    $('#c_desc').value = 'Groceries';
    $('#c_cat').value = 'food';
    $('#c_uid').value = 123123;
    $('#c_sum').value = 87.9;
    $('#c_date').value = '';
  });

  $('#btnAddCost').addEventListener('click', async ()=>{
    const body = {
      description: $('#c_desc').value.trim(),
      category: $('#c_cat').value,
      userid: Number($('#c_uid').value),
      sum: Number($('#c_sum').value)
    };
    const d = $('#c_date').value; if(d) body.created_at = d; // YYYY-MM-DD
    await send('POST','/api/add', body);
  });

  // ——— report ———
  $('#btnReport').addEventListener('click', async ()=>{
    const uid = Number($('#r_uid').value);
    const ym = $('#r_month').value; // "YYYY-MM"
    if(!ym){ showToast('Pick month'); return; }
    const [y,m] = ym.split('-');
    const q = `?id=${encodeURIComponent(uid)}&year=${encodeURIComponent(y)}&month=${encodeURIComponent(Number(m))}`;
    await send('GET', `/api/report${q}`);
    tabs.forEach(x=>x.classList.remove('active')); tabs[1].classList.add('active');
    reqPre.style.display='none'; resPre.style.display='block';
  });

  // ——— lookup ———
  $('#btnGetUser').addEventListener('click', async ()=>{
    const uid = Number($('#lu_uid').value);
    await send('GET', `/api/users/${encodeURIComponent(uid)}`);
  });
  $('#btnListUsers').addEventListener('click', async ()=>{
    await send('GET', '/api/users');
  });
  $('#btnLogs').addEventListener('click', async ()=>{
    await send('GET', '/api/logs');
  });

  // copy / clear
  $('#copyBtn').addEventListener('click', async ()=>{
    const active = document.querySelector('.tab.active').dataset.tab;
    const txt = active==='req'? reqPre.textContent : resPre.textContent;
    try{ await navigator.clipboard.writeText(txt); showToast('Copied'); }catch{ showToast('Copy failed'); }
  });
  $('#clearBtn').addEventListener('click', ()=>{ reqPre.textContent='—'; resPre.textContent='—'; });

  // initial log
  log('Dashboard ready. Set Base URL to your API and start.');
  setBusy(false);
</script>
</body>
</html>
